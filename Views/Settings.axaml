<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:LoupixDeck.ViewModels"
        xmlns:bs="clr-namespace:LoupixDeck.ViewModels.Base"
        xmlns:cnv="clr-namespace:LoupixDeck.Models.Converter"
        xmlns:ccp="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.ColorPicker"
        x:Class="LoupixDeck.Views.Settings"
        x:DataType="vm:SettingsViewModel"
        mc:Ignorable="d"
        Title="Settings"
        Width="700"
        Height="600">

    <Window.Resources>
        <cnv:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
        <cnv:ScalingOptionConverter x:Key="ScalingOptionConverter" />
    </Window.Resources>

    <Grid ColumnDefinitions="200,*">

        <!-- Linke MenÃ¼-Spalte -->
        <StackPanel Grid.Column="0" Margin="5,10,5,0" Spacing="5">
            <Button Content="General"
                    Command="{Binding NavigateCommand}"
                    CommandParameter="{x:Static bs:SettingsView.General}"
                    HorizontalAlignment="Stretch" />
            <Button Content="OBS Studio"
                    Command="{Binding NavigateCommand}"
                    CommandParameter="{x:Static bs:SettingsView.Obs}"
                    HorizontalAlignment="Stretch" />
            <Button Content="Wallpaper"
                    Command="{Binding NavigateCommand}"
                    CommandParameter="{x:Static bs:SettingsView.Wallpaper}"
                    HorizontalAlignment="Stretch" />
            <Button Content="Global Commands"
                    Command="{Binding NavigateCommand}"
                    CommandParameter="{x:Static bs:SettingsView.GlobalCommands}"
                    HorizontalAlignment="Stretch" />
        </StackPanel>

        <Grid Grid.Column="1" Margin="20 5 0 0">
            <StackPanel
                IsVisible="{Binding CurrentView, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=General}">
                <TextBlock Text="General Settings" FontSize="24" FontWeight="Bold" />

                <TextBlock Text="Display Brightness:" Margin="0,10,0,0" />
                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                    <Slider Minimum="0" Maximum="100" HorizontalAlignment="Left" TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding Config.Brightness, Mode=TwoWay}" Width="200" />
                    <TextBlock Text="{Binding Config.Brightness}" VerticalAlignment="Center"></TextBlock>
                </StackPanel>

                <Separator Margin="0,20,0,10"/>
                <TextBlock Text="Touch Feedback" FontSize="18" FontWeight="Bold" />
                
                <CheckBox Content="Enable Touch Feedback" IsChecked="{Binding Config.TouchFeedbackEnabled}" Margin="0,10,0,0" />
                
                <TextBlock Text="Feedback Color:" Margin="0,10,0,0" />
                <ccp:ColorPicker Color="{Binding Config.TouchFeedbackColor}" Width="100" HorizontalAlignment="Left" Margin="0,5,0,0" />
                
                <TextBlock Text="Feedback Opacity:" Margin="0,10,0,0" />
                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,5,0,0">
                    <Slider Minimum="0" Maximum="1" HorizontalAlignment="Left" TickFrequency="0.1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding Config.TouchFeedbackOpacity, Mode=TwoWay}" Width="200" />
                    <TextBlock Text="{Binding Config.TouchFeedbackOpacity}" VerticalAlignment="Center"></TextBlock>
                </StackPanel>
            </StackPanel>

            <StackPanel
                IsVisible="{Binding CurrentView, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Obs}">
                <TextBlock Text="OBS Settings" FontSize="24" FontWeight="Bold" />

                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="IP:" Width="80" VerticalAlignment="Center" />
                    <TextBox Width="200" Text="{Binding ObsConfig.Ip, Mode=TwoWay}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="Port:" Width="80" VerticalAlignment="Center" />
                    <TextBox Width="200" Text="{Binding ObsConfig.Port, Mode=TwoWay}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="Password:" Width="80" VerticalAlignment="Center" />
                    <TextBox Width="200" Text="{Binding ObsConfig.Password, Mode=TwoWay}" PasswordChar="*" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="20" Margin="0 20 0 0">
                    <Button Content="Save" Width="120" HorizontalContentAlignment="Center"
                            Command="{Binding SaveObsCommand}" />
                    <Button Content="Test Connection" Width="150" HorizontalContentAlignment="Center"
                            Command="{Binding TestConnectionCommand}" />
                    <TextBlock IsVisible="{Binding ConnectionTestVisible}" Text="{Binding ConnectionResult}"
                               Foreground="{Binding TextColor}" />
                </StackPanel>
            </StackPanel>

            <StackPanel x:Name="Wallpaper"
                        IsVisible="{Binding CurrentView, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Wallpaper}">
                <TextBlock Text="Wallpaper" FontSize="24" FontWeight="Bold" />
                
                <!-- Page Selection -->
                <TextBlock Text="Select Page:" FontWeight="SemiBold" Margin="0,10,0,5" />
                <ComboBox Width="200" HorizontalAlignment="Left"
                          ItemsSource="{Binding AvailablePages}"
                          SelectedIndex="{Binding SelectedWallpaperPageIndex, Mode=TwoWay}"
                          Margin="0,0,0,10" />
                
                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                    <Border BorderBrush="Black" BorderThickness="2" CornerRadius="5">
                        <Image Width="400" Height="190" Source="{Binding CurrentWallpaper, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                    <StackPanel Spacing="5">
                        <Button Content="Select..." VerticalAlignment="Top" Command="{Binding SelectImageButtonCommand}" Width="80"></Button>
                        <Button Content="Remove" VerticalAlignment="Top" Command="{Binding RemoveWallpaperCommand}" Width="80"></Button>
                    </StackPanel>
                </StackPanel>
                <TextBlock Text="Opacity:" Margin="0,10,0,0" />
                <Slider Minimum="0" Maximum="1" HorizontalAlignment="Left" TickFrequency="0.1"
                        IsSnapToTickEnabled="True"
                        Value="{Binding WallpaperOpacity, Mode=TwoWay}" Width="200" />

                <!-- Scaling Controls -->
                <ComboBox Width="200" Margin="0,10,0,0"
                          ItemsSource="{Binding WallpaperScalingOptions}"
                          SelectedItem="{Binding SelectedWallpaperScalingOption, Mode=TwoWay}"
                          PlaceholderText="Scaling" />

                <TextBlock Text="Scale:" Margin="0,10,0,0" />
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Slider Minimum="1" Maximum="400" TickFrequency="1" IsSnapToTickEnabled="True"
                            Value="{Binding WallpaperScaling, Mode=TwoWay}" Width="200" />
                    <TextBlock Text="{Binding WallpaperScaling}"/>
                </StackPanel>

                <!-- Position Controls -->
                <TextBlock Text="Position X:" Margin="0,10,0,0" />
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Slider Minimum="-480" Maximum="480" TickFrequency="1" IsSnapToTickEnabled="True"
                            Value="{Binding WallpaperPositionX, Mode=TwoWay}" Width="200" />
                    <TextBlock Text="{Binding WallpaperPositionX}" />
                </StackPanel>

                <TextBlock Text="Position Y:" Margin="0,10,0,0" />
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Slider Minimum="-270" Maximum="270" TickFrequency="1" IsSnapToTickEnabled="True"
                            Value="{Binding WallpaperPositionY, Mode=TwoWay}" Width="200" />
                    <TextBlock Text="{Binding WallpaperPositionY}" />
                </StackPanel>
            </StackPanel>

            <ScrollViewer
                IsVisible="{Binding CurrentView, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=GlobalCommands}">
                <StackPanel>
                    <TextBlock Text="Global Commands" FontSize="24" FontWeight="Bold" />
                    <TextBlock Text="Apply prefix/suffix commands to all buttons of each type on a specific page" 
                               TextWrapping="Wrap" Margin="0,5,0,10" Foreground="Gray" />

                    <!-- Page Selection -->
                    <TextBlock Text="Select Page:" FontWeight="SemiBold" Margin="0,10,0,5" />
                    <ComboBox Width="200" HorizontalAlignment="Left"
                              ItemsSource="{Binding AvailablePages}"
                              SelectedIndex="{Binding SelectedPageIndex, Mode=TwoWay}"
                              Margin="0,0,0,20" />

                    <!-- Touch Buttons Section -->
                    <TextBlock Text="Touch Buttons" FontSize="18" FontWeight="Bold" Margin="0,10,0,5" />
                    
                    <CheckBox Content="Enable Prefix" IsChecked="{Binding TouchButtonPrefixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Prefix command (e.g., echo 'Touch started')" 
                             Text="{Binding TouchButtonPrefixCommand}"
                             IsEnabled="{Binding TouchButtonPrefixEnabled}"
                             Margin="0,5,0,10" />
                    
                    <CheckBox Content="Enable Suffix" IsChecked="{Binding TouchButtonSuffixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Suffix command (e.g., echo 'Touch ended')" 
                             Text="{Binding TouchButtonSuffixCommand}"
                             IsEnabled="{Binding TouchButtonSuffixEnabled}"
                             Margin="0,5,0,0" />

                    <Separator Margin="0,20,0,10"/>

                    <!-- Simple Buttons Section -->
                    <TextBlock Text="Simple Buttons" FontSize="18" FontWeight="Bold" Margin="0,10,0,5" />
                    
                    <CheckBox Content="Enable Prefix" IsChecked="{Binding SimpleButtonPrefixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Prefix command" 
                             Text="{Binding SimpleButtonPrefixCommand}"
                             IsEnabled="{Binding SimpleButtonPrefixEnabled}"
                             Margin="0,5,0,10" />
                    
                    <CheckBox Content="Enable Suffix" IsChecked="{Binding SimpleButtonSuffixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Suffix command" 
                             Text="{Binding SimpleButtonSuffixCommand}"
                             IsEnabled="{Binding SimpleButtonSuffixEnabled}"
                             Margin="0,5,0,0" />

                    <Separator Margin="0,20,0,10"/>

                    <!-- Knobs Section -->
                    <TextBlock Text="Knobs" FontSize="18" FontWeight="Bold" Margin="0,10,0,5" />
                    
                    <!-- Knob Left -->
                    <TextBlock Text="Rotate Left:" FontWeight="SemiBold" Margin="0,10,0,3" />
                    <CheckBox Content="Enable Prefix" IsChecked="{Binding KnobLeftPrefixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Prefix command for knob rotate left" 
                             Text="{Binding KnobLeftPrefixCommand}"
                             IsEnabled="{Binding KnobLeftPrefixEnabled}"
                             Margin="0,5,0,5" />
                    
                    <CheckBox Content="Enable Suffix" IsChecked="{Binding KnobLeftSuffixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Suffix command for knob rotate left" 
                             Text="{Binding KnobLeftSuffixCommand}"
                             IsEnabled="{Binding KnobLeftSuffixEnabled}"
                             Margin="0,5,0,10" />
                    
                    <!-- Knob Right -->
                    <TextBlock Text="Rotate Right:" FontWeight="SemiBold" Margin="0,10,0,3" />
                    <CheckBox Content="Enable Prefix" IsChecked="{Binding KnobRightPrefixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Prefix command for knob rotate right" 
                             Text="{Binding KnobRightPrefixCommand}"
                             IsEnabled="{Binding KnobRightPrefixEnabled}"
                             Margin="0,5,0,5" />
                    
                    <CheckBox Content="Enable Suffix" IsChecked="{Binding KnobRightSuffixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Suffix command for knob rotate right" 
                             Text="{Binding KnobRightSuffixCommand}"
                             IsEnabled="{Binding KnobRightSuffixEnabled}"
                             Margin="0,5,0,10" />
                    
                    <!-- Knob Press -->
                    <TextBlock Text="Press/Click:" FontWeight="SemiBold" Margin="0,10,0,3" />
                    <CheckBox Content="Enable Prefix" IsChecked="{Binding KnobPressPrefixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Prefix command for knob press" 
                             Text="{Binding KnobPressPrefixCommand}"
                             IsEnabled="{Binding KnobPressPrefixEnabled}"
                             Margin="0,5,0,5" />
                    
                    <CheckBox Content="Enable Suffix" IsChecked="{Binding KnobPressSuffixEnabled}" Margin="0,5,0,0" />
                    <TextBox Watermark="Suffix command for knob press" 
                             Text="{Binding KnobPressSuffixCommand}"
                             IsEnabled="{Binding KnobPressSuffixEnabled}"
                             Margin="0,5,0,10" />
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>