<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:LoupixDeck.ViewModels"
        xmlns:models="using:LoupixDeck.Models"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:LoupixDeck.Models.Converter"
        mc:Ignorable="d"
        Width="760" Height="460"
        CanResize="False"
        WindowStartupLocation="CenterScreen"
        x:Class="LoupixDeck.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel, IsDesignTimeCreatable=True}"
        Icon="avares://LoupixDeck/Assets/logo.ico"
        Title="LoupixDeck"
        x:Name="RootWindow">
    
    <Window.Styles>
        <Style Selector="Button[Tag=Touch]">
            <Setter Property="Background" Value="#0F0F0F" />
            <Setter Property="BorderBrush" Value="{StaticResource ButtonBorder}" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Width" Value="90" />
            <Setter Property="Height" Value="90" />
            <Setter Property="Effect" Value="{StaticResource InnerShadow}" />
        </Style>
        <Style Selector="Button[Tag=Narrow]">
            <Setter Property="Background" Value="#0F0F0F" />
            <Setter Property="BorderBrush" Value="#444" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Effect" Value="{StaticResource InnerShadow}" />
        </Style>
        <Style Selector="Button[Tag=Led]">
            <Setter Property="Background" Value="#FF0F0F0F" />
            <Setter Property="Effect" Value="{StaticResource InnerShadow}" />
        </Style>
        <Style Selector="Button[Tag=Mini]">
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Background" Value="{StaticResource PanelDark}" />
            <Setter Property="BorderBrush" Value="{StaticResource ButtonBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
        </Style>
    </Window.Styles>
    
    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Window.Resources>
        <conv:BoolToBrushConverter
            x:Key="BoolToBrushConverter"
            SelectedBrush="{StaticResource SelectedBrush}"
            UnselectedBrush="{StaticResource UnselectedBrush}" />
    </Window.Resources>

    <Grid RowDefinitions="Auto,Auto,Auto,Auto,*">
        
        <!-- Menu Button (Top Right Corner) -->
        <Button Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Top"
                Width="40" Height="40" Margin="0,5,10,0"
                Background="Transparent" BorderBrush="#555" BorderThickness="1" CornerRadius="5">
            <Image Source="{SvgImage avares://LoupixDeck/Assets/hamburger.svg}" Stretch="Uniform" Margin="5" />
            <Button.Flyout>
                <Flyout Placement="Bottom">
                    <StackPanel>
                        <Button Width="120" Height="40" Content="Settings" Command="{Binding SettingsMenuCommand}" />
                        <Separator />
                        <Button Width="120" Height="40" Content="About" Command="{Binding AboutMenuCommand}" />
                        <Button Width="120" Height="40" Margin="0,5,0,0" Content="Quit" Command="{Binding QuitApplicationCommand}" />
                    </StackPanel>
                </Flyout>
            </Button.Flyout>
        </Button>
        
        <!-- ROW 0: Rotary Page Controls (Horizontal, above grid) -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="2" Margin="0,10,0,5">
            <TextBlock Text="Rotary Pages:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#999"/>
            <ItemsControl ItemsSource="{Binding LoupedeckController.Config.RotaryButtonPages}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Tag="Mini" Content="{Binding Page}"
                                Command="{Binding ViewModel.RotaryPageButtonCommand, ElementName=RootWindow}"
                                CommandParameter="{Binding Page}"
                                Background="{Binding Selected, Converter={StaticResource BoolToBrushConverter}}" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <Button Tag="Mini" Content="+" Command="{Binding AddRotaryPageCommand}" />
            <Button Tag="Mini" Content="x" Command="{Binding DeleteRotaryPageCommand}" />
        </StackPanel>
        
        <!-- ROW 1: Main Device Area -->
        <Grid Grid.Row="1" ColumnDefinitions="90,70,*,70,90" Margin="10,0">
            
            <!-- COLUMN 0: Left 3 Knobs (Vertical) -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="5">
                <Button Width="80" Height="80" Background="Transparent" CornerRadius="40"
                        Command="{Binding RotaryButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentRotaryButtonPage.RotaryButtons[0]}">
                    <Border Width="80" Height="80" CornerRadius="40">
                        <Image Source="{SvgImage avares://LoupixDeck/Assets/dial.svg}" Stretch="UniformToFill" />
                    </Border>
                </Button>
                <Button Width="80" Height="80" Background="Transparent" CornerRadius="40"
                        Command="{Binding RotaryButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentRotaryButtonPage.RotaryButtons[1]}">
                    <Border Width="80" Height="80" CornerRadius="40">
                        <Image Source="{SvgImage avares://LoupixDeck/Assets/dial.svg}" Stretch="UniformToFill" />
                    </Border>
                </Button>
                <Button Width="80" Height="80" Background="Transparent" CornerRadius="40"
                        Command="{Binding RotaryButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentRotaryButtonPage.RotaryButtons[2]}">
                    <Border Width="80" Height="80" CornerRadius="40">
                        <Image Source="{SvgImage avares://LoupixDeck/Assets/dial.svg}" Stretch="UniformToFill" />
                    </Border>
                </Button>
            </StackPanel>

            <!-- COLUMN 1: Left Narrow Display (60×270 - ONE tall button) -->
            <Button Tag="Narrow" Grid.Column="1" Width="60" Height="270" Padding="0"
                    Command="{Binding TouchButtonCommand}"
                    CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[12]}">
                <Border CornerRadius="4" ClipToBounds="True">
                    <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[12].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" 
                           Stretch="Fill"/>
                </Border>
            </Button>

            <!-- COLUMN 2: CENTER Touch Button Grid (360×270 - 4×3 = indices 0-11) -->
            <Grid Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center" 
                  RowDefinitions="90,90,90" ColumnDefinitions="90,90,90,90">
                <!-- Row 0 -->
                <Button Tag="Touch" Grid.Row="0" Grid.Column="0" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[0]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[0].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="0" Grid.Column="1" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[1]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[1].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="0" Grid.Column="2" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[2]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[2].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="0" Grid.Column="3" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[3]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[3].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <!-- Row 1 -->
                <Button Tag="Touch" Grid.Row="1" Grid.Column="0" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[4]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[4].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="1" Grid.Column="1" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[5]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[5].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="1" Grid.Column="2" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[6]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[6].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="1" Grid.Column="3" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[7]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[7].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <!-- Row 2 -->
                <Button Tag="Touch" Grid.Row="2" Grid.Column="0" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[8]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[8].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="2" Grid.Column="1" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[9]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[9].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="2" Grid.Column="2" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[10]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[10].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
                <Button Tag="Touch" Grid.Row="2" Grid.Column="3" Margin="3"
                        Command="{Binding TouchButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[11]}">
                    <Border CornerRadius="6" ClipToBounds="True">
                        <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[11].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}" />
                    </Border>
                </Button>
            </Grid>

            <!-- COLUMN 3: Right Narrow Display (60×270 - ONE tall button) -->
            <Button Tag="Narrow" Grid.Column="3" Width="60" Height="270" Padding="0"
                    Command="{Binding TouchButtonCommand}"
                    CommandParameter="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[13]}">
                <Border CornerRadius="4" ClipToBounds="True">
                    <Image Source="{Binding LoupedeckController.Config.CurrentTouchButtonPage.TouchButtons[13].RenderedImage, Converter={StaticResource SkiaToBitmapConverter}}"
                           Stretch="Fill"/>
                </Border>
            </Button>

            <!-- COLUMN 4: Right 3 Knobs (Vertical) -->
            <StackPanel Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="5">
                <Button Width="80" Height="80" Background="Transparent" CornerRadius="40"
                        Command="{Binding RotaryButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentRotaryButtonPage.RotaryButtons[3]}">
                    <Border Width="80" Height="80" CornerRadius="40">
                        <Image Source="{SvgImage avares://LoupixDeck/Assets/dial.svg}" Stretch="UniformToFill" />
                    </Border>
                </Button>
                <Button Width="80" Height="80" Background="Transparent" CornerRadius="40"
                        Command="{Binding RotaryButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentRotaryButtonPage.RotaryButtons[4]}">
                    <Border Width="80" Height="80" CornerRadius="40">
                        <Image Source="{SvgImage avares://LoupixDeck/Assets/dial.svg}" Stretch="UniformToFill" />
                    </Border>
                </Button>
                <Button Width="80" Height="80" Background="Transparent" CornerRadius="40"
                        Command="{Binding RotaryButtonCommand}"
                        CommandParameter="{Binding LoupedeckController.Config.CurrentRotaryButtonPage.RotaryButtons[5]}">
                    <Border Width="80" Height="80" CornerRadius="40">
                        <Image Source="{SvgImage avares://LoupixDeck/Assets/dial.svg}" Stretch="UniformToFill" />
                    </Border>
                </Button>
            </StackPanel>
        </Grid>

        <!-- ROW 2: Touch Page Controls (Horizontal, below grid) -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="2" Margin="0,10">
            <TextBlock Text="Touch Pages:" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#999"/>
            <ItemsControl ItemsSource="{Binding LoupedeckController.Config.TouchButtonPages}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Tag="Mini" Content="{Binding Page}"
                                Command="{Binding ViewModel.TouchPageButtonCommand, ElementName=RootWindow}"
                                CommandParameter="{Binding Page}"
                                Background="{Binding Selected, Converter={StaticResource BoolToBrushConverter}}" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <Button Tag="Mini" Content="+" Command="{Binding AddTouchPageCommand}" />
            <Button Tag="Mini" Content="x" Command="{Binding DeleteTouchPageCommand}" />
        </StackPanel>

        <!-- ROW 3: Physical Buttons (8 for Razer, 4 for Live S) -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8" Margin="0,10">
            <ItemsControl ItemsSource="{Binding LoupedeckController.Config.SimpleButtons}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:SimpleButton">
                        <Button Tag="Led" Width="50" Height="50" CornerRadius="25"
                                Command="{Binding ViewModel.SimpleButtonCommand, ElementName=RootWindow}"
                                CommandParameter="{Binding}">
                            <Image Width="50" Height="50" Source="{Binding RenderedImage}" />
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </Grid>
</Window>
